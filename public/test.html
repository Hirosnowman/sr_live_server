<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SR 過去コメント表示テスト</title>
<style>
body { font-family: sans-serif; margin: 10px; }
#comment div { display:flex; align-items:center; margin-bottom:5px; }
#comment img { width:40px; height:40px; margin-right:5px; }
</style>
</head>
<body>

<h2>過去コメントテスト</h2>
<label>Room ID: <input type="text" id="roomInput" value="490133"></label>
<button id="loadComments">表示</button>
<div id="comment"></div>

<script>
async function loadPastComments(roomId){
    try{
        const res = await fetch(`https://www.showroom-live.com/api/live/comment_log?room_id=${roomId}`);
        const logs = await res.json();
        console.log("取得ログ:", logs); // デバッグ用

        const commentBox = document.getElementById("comment");
        commentBox.innerHTML = "";

        if(!Array.isArray(logs)){
            commentBox.textContent = "コメントデータなし";
            return;
        }

        logs.forEach(log => {
            const div = document.createElement("div");
            const img = document.createElement("img");
            img.src = `https://image.showroom-cdn.com/showroom-prod/image/avatar/${log.avatar_id || 0}.png`;
            const p = document.createElement("p");
            p.textContent = `${log.name}：${log.comment}`;
            div.appendChild(img);
            div.appendChild(p);
            commentBox.appendChild(div);
        });
    } catch(e){
        console.error("過去コメント取得失敗", e);
        document.getElementById("comment").textContent = "取得エラー";
    }
}

document.getElementById("loadComments").onclick = ()=>{
    const roomId = document.getElementById("roomInput").value.trim();
    loadPastComments(roomId);
};
</script>

</body>
</html>
