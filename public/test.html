<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta charset="UTF-8">
<title>過去コメント取得テスト</title>
<style>
body { font-family:sans-serif; background:#f0f0f0; padding:20px; }
#comment { border:1px solid #ccc; background:#fff; padding:10px; max-height:600px; overflow-y:auto; }
#comment div { display:flex; align-items:center; margin-bottom:5px; }
#comment img { width:40px; height:40px; margin-right:5px; }
</style>
</head>
<body>

<h2>過去コメント取得テスト</h2>
<label>Room ID: <input type="text" id="roomInput" value="198346"></label>
<button id="loadPast">取得</button>

<div id="comment"></div>

<script>
function showComment(c){
    const div = document.createElement("div");
    const img = document.createElement("img");
    img.src = `https://image.showroom-cdn.com/showroom-prod/image/avatar/${c.avatar_id || c.av || 0}.png`;
    const p = document.createElement("p");
    p.textContent = `${c.name || c.ac}：${c.comment || c.cm} ★補完★`;
    div.appendChild(img);
    div.appendChild(p);
    document.getElementById("comment").prepend(div);
}

document.getElementById("loadPast").onclick = async ()=>{
    const roomId = document.getElementById("roomInput").value.trim();
    if(!roomId) return alert("Room IDを入力してください");

    document.getElementById("comment").innerHTML = "読み込み中...";

    try{
        const res = await fetch(`/get_comment_log?room_id=${roomId}`);
        const logs = await res.json();
        document.getElementById("comment").innerHTML = "";
        if(!Array.isArray(logs) || logs.length===0){
            document.getElementById("comment").textContent = "コメントなし";
            return;
        }
        // 最新10件を表示
        logs.slice(-10).forEach(c=>showComment(c));
    } catch(e){
        console.error(e);
        document.getElementById("comment").textContent = "取得エラー";
    }
};
</script>
</body>
</html>
